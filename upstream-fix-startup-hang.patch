# HG changeset patch
# User Kershaw Chang <kershaw@mozilla.com>
# Date 1610706521 0
# Node ID 5f0a8b3326e78e83da476c8d34842a5b3390072d
# Parent  3ff621cea4dcd1b0c87391f689d272deea70c4b2
Bug 1679933 - Call EnsureNSSInitializedChromeOrContent() during nsHttpHandler initialization r=necko-reviewers,dragana

Differential Revision: https://phabricator.services.mozilla.com/D101782

diff --git a/netwerk/base/nsNetUtil.cpp b/netwerk/base/nsNetUtil.cpp
--- a/netwerk/base/nsNetUtil.cpp
+++ b/netwerk/base/nsNetUtil.cpp
@@ -2709,19 +2709,18 @@ void net_EnsurePSMInit() {
   if (XRE_IsSocketProcess()) {
     EnsureNSSInitializedChromeOrContent();
     return;
   }
 
   MOZ_ASSERT(XRE_IsParentProcess());
   MOZ_ASSERT(NS_IsMainThread());
 
-  nsresult rv;
-  nsCOMPtr<nsISupports> psm = do_GetService(PSM_COMPONENT_CONTRACTID, &rv);
-  MOZ_ASSERT(NS_SUCCEEDED(rv));
+  DebugOnly<bool> rv = EnsureNSSInitializedChromeOrContent();
+  MOZ_ASSERT(rv);
 
 #ifndef MOZ_NEW_CERT_STORAGE
   nsCOMPtr<nsISupports> cbl = do_GetService(NS_CERTBLOCKLIST_CONTRACTID);
 #endif
 }
 
 bool NS_IsAboutBlank(nsIURI* uri) {
   // GetSpec can be expensive for some URIs, so check the scheme first.


